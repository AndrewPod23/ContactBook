<!DOCTYPE html>
<html>
<head lang="ru">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit contact</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="css/popUpWindow.css" rel="stylesheet">
    <script src="js/mustache.js"></script>
    <script src="js/getJsonResponse.js"></script>
    <script src="js/contactValidation.js"></script>
    <script src="js/phoneValidation.js"></script>
    <script src="js/attachmentValidation.js"></script>

    <script src="js/phoneData.js"></script>
    <script src="js/editPhone.js"></script>
    <script src="js/handleServerErrors.js"></script>
    <script src="js/attachmentData.js"></script>
    <script src="js/editAttachment.js"></script>
    <script id="rowTemplate" type="text/template">
        <tr>
            <td><input type="checkbox" name="checkPhone" value="{{phoneNumber}}"></td>
            <td>{{countryCode}}</td>
            <td>{{operatorCode}}</td>
            <td>{{phoneNumber}}</td>
            <td>{{type}}</td>
            <td>{{comment}}</td>
        </tr>
    </script>
    <script id="rowTemplate2" type="text/template">
        <tr>
            <td><input type="checkbox" class="{{attachmentId}}" name="checkAttachment" value="{{state}}"></td>
            <td>{{fileName}}</td>
            <td>{{loadedDate}}</td>
            <td>{{comment}}</td>
        </tr>
    </script>
    <script>
      "use strict";

      function renderPhones(phones) {
        var rowTemplate = document.getElementById("rowTemplate").innerHTML;
        var phonesHTML = "";
        phones.forEach(function (phone) {
          phonesHTML += Mustache.render(rowTemplate, phone);
        });
        document.getElementById("phones").innerHTML = phonesHTML;
      }

      function renderAttachments(attachments) {
        var rowTemplate = document.getElementById("rowTemplate2").innerHTML;
        var attachmentsHTML = "";
        attachments.forEach(function (attachment) {
          attachmentsHTML += Mustache.render(rowTemplate, attachment);
        });
        document.getElementById("attachments").innerHTML = attachmentsHTML;
      }

      var id = window.location.search.split("=")[1];
      fetch("controller/contacts_phones?contact_id=" + id).then(function (resp) {
        var status = resp.status;
        if (status === 200) {
          resp.json().then(renderPhones);
        } else {
          console.log(resp);
        }
      });
      fetch("controller/contacts_attachments?contact_id=" + id).then(function (resp) {
        var status = resp.status;
        if (status === 200) {
          resp.json().then(renderAttachments);
        } else {
          console.log(resp);
        }
      });


      function fillInputContact() {
        fetch("controller/contact_info?contact_id=" + id).then(function (resp) {
          var status = resp.status;
          if (status === 200) {
            resp.json().then(function (data) {
              document.getElementById("id").value = id;
              document.getElementById("name").value = data.name;
              document.getElementById("surname").value = data.surname;
              document.getElementById("patronymic").value = data.patronymic;
              var year = "year", month = "month", day = "day";
              if (data.birthday !== null) {
                var dateArray = data.birthday.split("-");
                year = dateArray[0];
                month = parseInt(dateArray[1]);
                day = parseInt(dateArray[2]);
              }
              document.getElementById("yearSelect").value = year;
              document.getElementById("monthSelect").value = month;
              document.getElementById("daySelect").value = day;
              document.getElementById("nationality").value = data.nationality;
              var g = data.gender;
              if (g === "male") {
                document.getElementById("genderMale").checked = true;
              }
              if (g === "female") {
                document.getElementById("genderFemale").checked = true;
              }
              var m = data.maritalStatus;
              if (m === "married") {
                document.getElementById("statusMarried").checked = true;
              }
              if (m === "single") {
                document.getElementById("statusSingle").checked = true;
              }
              document.getElementById("email").value = data.email;
              document.getElementById("webSite").value = data.webSite;
              document.getElementById("placeOfWork").value = data.placeOfWork;
              document.getElementById("country").value = data.address.country;
              document.getElementById("city").value = data.address.city;
              document.getElementById("street").value = data.address.street;
              document.getElementById("houseNumber").value = data.address.houseNumber;
              document.getElementById("flatNumber").value = data.address.flatNumber;
              document.getElementById("zipCode").value = data.address.zipCode;
            });
          } else {
            handleValidationErrors(resp)
          }
        });
      }

      fillInputContact();

      function insertPhoto() {
        fetch("controller/contact_image?contact_id=" + id).then(function (resp) {
          var status = resp.status;
          if (status === 200) {
            resp.json().then(function (data) {
              var image = new Image();
              image.src = 'data:image/png;base64,' + data;
              document.getElementById("contactPhoto").src = image.src;
            });
          } else {
            handleValidationErrors(resp);
          }
        });
      }

      insertPhoto();

      function deletePhones() {
        var phones = [];
        var checkboxes = document.querySelectorAll("input[type=checkbox]:checked[name=checkPhone]");
        for (var i = 0; i < checkboxes.length; i++) {
          phones.push(checkboxes[i].value);
        }
        if (phones.length === 0) {
          alert("You didn't choose phones!");
        } else {
          var table = document.getElementById("phonesTable");
          for (var j = 1, row; row = table.rows[j]; j++) {
            var number = row.cells[3].innerHTML;
            if (phones.includes(number)) {
              table.deleteRow(j);
              j--;
            }
          }
        }
      }

      function deleteAttachments() {
        var attachments = [];
        var checkboxes = document.querySelectorAll("input[type=checkbox]:checked[value=old]," +
          "input[type=checkbox]:checked[value=edit], input[type=checkbox]:checked[value=new]");
        for (var i = 0; i < checkboxes.length; i++) {
          attachments.push(checkboxes[i].getAttribute("class"));
        }
        if (attachments.length === 0) {
          alert("You didn't choose attachments (white, yellow or green cell)!");
        } else {
          var table = document.getElementById("attachmentsTable");
          for (var j = 1, row; row = table.rows[j]; j++) {
            var name = table.rows[j].cells[0].childNodes[0].className;
            if (attachments.includes(name)) {
              if (!isNaN(name)) {
                table.rows[j].cells[1].style.backgroundColor = "red";
                table.rows[j].cells[0].childNodes[0].value = "deleted";
              } else {
                var form = document.getElementById("editForm");
                var input = document.getElementById(name);
                if (form.contains(input)) {
                  input.remove();
                }
                table.deleteRow(j);
                j--;
              }
            }
          }
        }
      }

      function editPhoneFillInputs() {
        var phone = [];
        var checkboxes = document.querySelectorAll("input[type=checkbox]:checked[name=checkPhone]");
        for (var i = 0; i < checkboxes.length; i++) {
          phone.push(checkboxes[i].value);
        }
        if (phone.length === 0 || phone.length > 1) {
          alert("Choose only 1 phone!");
        } else {
          document.getElementById("editPhonePopUp").style.display = "block";
          document.getElementById("addPhonePopUp").style.display = "none";
          document.getElementById("addAttachmentPopUp").style.display = "none";
          document.getElementById("editAttachmentPopUp").style.display = "none";
          var table = document.getElementById("phonesTable");
          var length = table.rows.length;
          var rowToUpdate;
          for (i = 1; i < length; i++) {
            var num = table.rows[i].cells[3].innerHTML;
            if (num === phone[0]) {
              rowToUpdate = table.rows[i];
            }
          }
          var countryCode = rowToUpdate.cells[1].innerHTML;
          var operatorCode = rowToUpdate.cells[2].innerHTML;
          var phoneNumber = rowToUpdate.cells[3].innerHTML;
          var type = rowToUpdate.cells[4].innerHTML;
          var comment = rowToUpdate.cells[5].innerHTML;
          document.getElementById("countryCode2").value = countryCode;
          document.getElementById("operatorCode2").value = operatorCode;
          document.getElementById("phoneNumber2").value = phoneNumber;
          if (type === "home") {
            document.getElementById("typeHome2").checked = true;
          }
          if (type === "mobile") {
            document.getElementById("typeMobile2").checked = true;
          }
          document.getElementById("comment2").value = comment;
        }
      }

      function editAttachmentFillInputs() {
        var attachment = [];
        var checkboxes = document.querySelectorAll("input[type=checkbox]:checked[value=old]," +
          "input[type=checkbox]:checked[value=edit]");
        for (var i = 0; i < checkboxes.length; i++) {
          attachment.push(checkboxes[i].value);
        }
        if (attachment.length === 0 || attachment.length > 1) {
          alert("You can edit only 1 attachment!");
        } else {
          document.getElementById("editAttachmentPopUp").style.display = "block";
          document.getElementById("editPhonePopUp").style.display = "none";
          document.getElementById("addPhonePopUp").style.display = "none";
          document.getElementById("addAttachmentPopUp").style.display = "none";
          var table = document.getElementById("attachmentsTable");
          var length = table.rows.length;
          var rowToUpdate;
          var attachmentId = checkboxes[0].getAttribute("class");
          for (i = 1; i < length; i++) {
            var num = table.rows[i].cells[0].childNodes[0].className;
            if (num === attachmentId) {
              rowToUpdate = table.rows[i];
            }
          }
          var fileName = rowToUpdate.cells[1].innerHTML;
          var comment = rowToUpdate.cells[3].innerHTML;
          document.getElementById("fileName2").value = fileName.split(".")[0];
          document.getElementById("fileExtension").value = fileName.split(".")[1];
          document.getElementById("attachmentComment2").value = comment;
        }
      }

      function tablePhonesJson() {
        var table = document.getElementById("phonesTable");
        var length = table.rows.length;
        var allPhones = [];
        for (var i = 1; i < length; i++) {
          var countryCode = table.rows[i].cells[1].innerHTML;
          if (countryCode.length === 0) {
            countryCode = null;
          } else {
            countryCode = parseInt(countryCode);
          }
          var operatorCode = table.rows[i].cells[2].innerHTML;
          if (operatorCode.length === 0) {
            operatorCode = null;
          } else {
            operatorCode = parseInt(operatorCode);
          }
          var phoneNumber = table.rows[i].cells[3].innerHTML;
          phoneNumber = parseInt(phoneNumber);
          var type = table.rows[i].cells[4].innerHTML;
          if (type.length === 0) {
            type = null;
          }
          var comment = table.rows[i].cells[5].innerHTML;
          if (comment.length === 0) {
            comment = null;
          }
          var phoneInfo = {
            "contactId": parseInt(id), "countryCode": countryCode, "operatorCode": operatorCode,
            "phoneNumber": phoneNumber, "type": type, "comment": comment
          };
          allPhones.push(phoneInfo);
        }
        document.getElementById("allPhones").value = JSON.stringify(allPhones);
      }

      function tableAttachmentsJson() {
        var table = document.getElementById("attachmentsTable");
        var length = table.rows.length;
        var allAttachments = [];
        for (var i = 1; i < length; i++) {
          var attachmentId = table.rows[i].cells[0].childNodes[0].className;
          var state = table.rows[i].cells[0].childNodes[0].value;
          var fileName = table.rows[i].cells[1].innerHTML;
          var loadedDate = table.rows[i].cells[2].innerHTML;
          var comment = table.rows[i].cells[3].innerHTML;
          if (comment.length === 0) {
            comment = null;
          }
          var attachmentInfo = {
            "attachmentId": parseInt(attachmentId), "contactId": parseInt(id), "state": state,
            "fileName": fileName, "loadedDate": loadedDate, "comment": comment
          };
          allAttachments.push(attachmentInfo);
        }
        document.getElementById("allAttachments").value = JSON.stringify(allAttachments);
      }

      window.onload = function () {
        var image = document.getElementById("contactPhoto");
        var upload = document.getElementById("uploadPhoto");
        image.onclick = function () {
          upload.click();
        };
      };

      function changePhoto() {
        var preview = document.getElementById('contactPhoto');
        var file = document.querySelector('input[type=file]').files[0];
        var fileReader = new FileReader();

        fileReader.onloadend = function () {
          preview.src = fileReader.result;
        };

        if (file) {
          fileReader.readAsDataURL(file);
        }
      }

      function savePhoto() {
        document.getElementById("photo").value = document.getElementById("contactPhoto").src;
      }

      function downloadAttachment() {
        var attachment = [];
        var checkboxes = document.querySelectorAll("input[type=checkbox]:checked[value=old]");
        for (var i = 0; i < checkboxes.length; i++) {
          attachment.push(checkboxes[i].getAttribute("class"));
        }
        if (attachment.length === 0 || attachment.length > 1) {
          alert("You can download only white attachment!");
        } else {
          var href = "controller/download_attachment?attachment_id=" + attachment[0];
          var download = document.createElement("a");
          download.href = href;
          download.click();
        }
      }
    </script>
</head>
<body>
<div class="container-fluid">
    <!--<h1>Photo</h1>-->
    <img class="img-rounded" id="contactPhoto" style="width:15% " height="20%" alt="Unable to load photo">
    <input type="file" id="uploadPhoto" accept=".jpg, .jpeg, .png" style="display: none" onchange="changePhoto()">
</div>
<br>
<div class="container-fluid">

    <h4>Personal info</h4>
    <form id="editForm" name="editForm" enctype="multipart/form-data">
        <input type="hidden" name="id" id="id">
        <input type="hidden" name="allPhones" id="allPhones">
        <input type="hidden" name="allAttachments" id="allAttachments">
        <input type="hidden" name="photo" id="photo">
        <div class="row">
            <div class="form-group mr-3 col-sm-3">
                <label for="name" class="control-label"><b>Name*:</b></label>
                <p id="validateName" style="color: crimson"></p>
                <input type="text" id="name" name="name" class="form-control" placeholder="First name"
                       maxlength="20">
            </div>
            <div class="form-group mr-3 col-sm-3">
                <label for="surname" class="control-label"><b>Surname*:</b></label>
                <p id="validateSurname" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="Surname" id="surname" name="surname"
                       maxlength="20">
            </div>
            <div class="form-group mr-3 col-sm-3">
                <label for="patronymic" class="control-label"><b>Patronymic:</b></label>
                <p id="validatePatronymic" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="Patronymic" id="patronymic"
                       name="patronymic" maxlength="20">
            </div>


        </div>
        <br><br>
        <div class="row">
            <div class="form-group mr-3 col-sm-3">
                <br>
                <label for="yearSelect" class="control-label"><b>Birthday:</b></label>
                <p id="validateBorn" style="color: crimson"></p>
                <select id="yearSelect" name="year">
                    <option value="year">Year</option>
                </select>
                <select id="monthSelect" name="month">
                    <option value="month">Month</option>
                </select>
                <select id="daySelect" name="day">
                    <option value="day">Day</option>
                </select>
            </div>

            <div class="form-group mr-3 col-sm-3">
                <label for="nationality" class="control-label"><b>Nationality:</b></label>
                <p id="validateNat" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="Nationality" id="nationality"
                       name="nationality" maxlength="20">

            </div>
            <div class="form-group mr-3 radio col-sm-3">
                <br>
                <label for="gender" class="control-label"><b>Gender:</b></label>

                <input type="radio" name="gender" value="male" id="gender">Male
                <input type="radio" name="gender" value="female">Female
                <br>
            </div>


        </div>
        <div class="row">
            <div class="form-group mr-3 radio col-sm-3">
                <br>
                <label class="control-label" for="maritalStatus"><b>Marital status:</b></label>

                <input class="radio" type="radio" name="maritalStatus" value="married" id="maritalStatus">Married
                <input class="radio" type="radio" name="maritalStatus" value="single">Single

            </div>
            <div class="form-group mr-3 col-sm-3">
                <label for="email" class="control-label"><b>Email:</b></label>
                <p id="validateEmail" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="Email" id="email" name="email"
                       maxlength="45">

            </div>
            <div class="form-group mr-3 col-sm-3">
                <label for="webSite" class="control-label"><b>Web site:</b></label>
                <p id="validateWeb" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="WebSite" id="webSite" name="webSite"
                       maxlength="45">

            </div>
            <div class="form-group mr-3 col-sm-3">
                <label for="placeOfWork" class="control-label"><b>Place of work:</b></label>
                <p id="validatePlace" style="color: crimson"></p>
                <input type="text" class="form-control" placeholder="Place of Work" id="placeOfWork"
                       name="placeOfWork" maxlength="30">
            </div>
        </div>
        <br>
        <h3 class="display-5 mb-5">Address</h3>
        <div class="row">
            <div class="form-group mr-3 col-sm-3">
                <label class="control-label" for="country"><b>Country:</b></label>
                <p id="validateCountry" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="Country" id="country" name="country"
                       maxlength="30">
            </div>
            <div class="form-group mr-3 col-sm-3">
                <label class="control-label" for="city"><b>City:</b></label>
                <p id="validateCity" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="City" id="city" name="city" maxlength="20">
            </div>
            <div class="form-group mr-3 col-sm-3">
                <label class="control-label" for="street"><b>Street:</b></label>
                <p id="validateStreet" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="Street" id="street" name="street"
                       maxlength="20">
            </div>

        </div>
        <div class="row">
            <div class="form-group mr-5  col-sm-1">
                <label class="control-label" for="houseNumber"><b>Building:</b></label>
                <p id="validateHouse" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="Building" id="houseNumber" name="houseNumber"
                       maxlength="5">
            </div>
            <div class="form-group mr-5  col-sm-1">
                <label class="control-label" for="flatNumber"><b>Appartments:</b></label>
                <p id="validateFlat" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="Apt." id="flatNumber" name="flatNumber"
                       maxlength="5">
            </div>
            <div class="form-group mr-5  col-sm-1">
                <label class="control-label" for="zipCode"><b>Zip Code:</b></label>
                <p id="validateZip" style="color: crimson"></p>
                <input type=text class="form-control" placeholder="Zip Code" id="zipCode" name="zipCode"
                       maxlength="8">
            </div>
        </div>
    </form>
</div>
<br>

<div class="container-fluid">
    <div class="phoneInfo">
        <h2>Contact's phones</h2>
        <button class="btn btn-outline-primary mr-4" id="openAddPopUp">Add</button>
        <button class="btn btn-outline-danger mr-4" id="deleteButton">Delete</button>
        <button class="btn btn-outline-primary mr-4" id="openEditPopUp">Edit</button>
    </div>
    <div class="form-popup" id="addPhonePopUp">
        <form name="addPhoneForm" class="form-container">
            <h1>New phone</h1>
            <label for="countryCode">Country code</label>
            <p id="validateCountryCode" style="color: crimson"></p>
            <input type="text" name="countryCode" id="countryCode">
            <label for="operatorCode">Operator code</label>
            <p id="validateOperatorCode" style="color: crimson"></p>
            <input type="text" name="operatorCode" id="operatorCode">
            <label for="phoneNumber">Phone number</label>
            <p id="validatePhone" style="color: crimson"></p>
            <input type="text" name="phoneNumber" id="phoneNumber">
            <label class="mr-1" for="typeHome">Type:</label>
            <input class="mr-1" type="radio" name="type" value="home" id="typeHome">Home
            <input class="ml-2 mr-1" type="radio" name="type" value="mobile" id="typeMobile">Mobile<br>
            <label for="comment">Comment</label>
            <p id="validateComment" style="color: crimson"></p>
            <input type="text" name="comment" id="comment">
            <button type="button" class="btn btn-outline-primary mr-4" id="createPhone">Submit</button>
            <button type="button" class="btn btn-outline-danger mr-4 cancel" id="closeAddPopUp">Cancel</button>
        </form>
    </div>


    <div class="form-popup" id="editPhonePopUp">
        <form name="editPhoneForm" class="form-container">
            <h1>Edit phone</h1>
            <label for="countryCode2"><b>Country code:</b></label>
            <p id="validateCountryCode2" style="color: crimson"></p>
            <input type="text" name="countryCode2" id="countryCode2" maxlength="4">

            <label for="operatorCode2"><b>Operator code:</b></label>
            <p id="validateOperatorCode2" style="color: crimson"></p>
            <input type="text" name="operatorCode2" id="operatorCode2" maxlength="4">

            <label for="phoneNumber2">Phone number:</label>
            <p id="validatePhone2" style="color: crimson"></p>
            <input type="text" name="phoneNumber2" id="phoneNumber2" maxlength="15">

            <label class="mr-1" for="typeHome2">Type:</label>
            <input class="mr-1" type="radio" name="type2" value="home" id="typeHome2">Home
            <input class="ml-2 mr-1" type="radio" name="type2" value="mobile" id="typeMobile2">Mobile<br>

            <label for="comment2">Comment:</label>
            <p id="validateComment2" style="color: crimson"></p>
            <input type="text" name="comment" id="comment2" maxlength="20">

            <button type="button" class="btn btn-outline-primary mr-4" id="editPhone">Submit</button>
            <button type="button" class="btn btn-outline-danger mr-4" id="closeEditPopUp">Cancel</button>
        </form>
    </div>
</div>
<br>
<div class="phone">
    <table id="phonesTable" class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <th>√</th>
            <th>Country code</th>
            <th>Operator code</th>
            <th>Number</th>
            <th>Type</th>
            <th>Comments</th>
        </tr>
        </thead>
        <tbody id="phones"></tbody>
    </table>
</div>

<div class="container-fluid">
    <h1>Contact's attachments</h1>
    <button class="btn btn-outline-primary mr-4" id="openAddAttachmentPopUp">Add</button>
    <button class="btn btn-outline-danger mr-4" id="deleteAttachmentButton">Delete</button>
    <button class="btn btn-outline-primary mr-4" id="openEditAttachmentPopUp">Edit</button>
    <button class="btn btn-outline-primary mr-4" id="downloadAttachmentsButton">Download</button>
    <div class="form-popup" id="addAttachmentPopUp">
        <form name="addAttachmentForm" class="form-container">
            <h1>New attachment</h1>
            <label for="fileName"><b>File:</b></label>
            <p id="validateAttachmentName" style="color: crimson"></p>
            <input type="file" name="fileName" id="fileName">
            <label for="attachmentComment"><b>Comment:</b></label>
            <p id="validateAttachmentComment" style="color: crimson"></p>
            <input type="text" name="attachmentComment" id="attachmentComment">
            <button type="button" class="btn btn-outline-primary mr-4" id="createAttachment">Submit</button>
            <button type="button" class="btn btn-outline-danger mr-4" id="closeAddAttachmentPopUp">Cancel</button>
        </form>
    </div>


    <div class="form-popup" id="editAttachmentPopUp">
        <form name="editAttachmentForm" class="form-container">
            <h1>Edit attachment</h1>
            <label for="fileName2"><b>File:</b></label>
            <p id="vAttachName" style="color: crimson"></p>
            <input type="text" name="fileName2" id="fileName2">
            <label for="fileExtension"><b>Extension:</b></label>
            <input type="text" name="fileExtension" id="fileExtension" readonly>
            <label for="attachmentComment2"><b>Comment:</b></label>
            <p id="vAttachComment" style="color: crimson"></p>
            <input type="text" name="attachmentComment2" id="attachmentComment2" maxlength="45">
            <button type="button" class="btn btn-outline-primary mr-4" id="editAttachment">Submit</button>
            <button type="button" class="btn btn-outline-danger mr-4" id="closeEditAttachmentPopUp">Cancel</button>
        </form>
    </div>
</div>
<br>
<div class="container-fluid">
    <table id="attachmentsTable" class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <th>√</th>
            <th>File name</th>
            <th>Date of load</th>
            <th>Comments</th>
        </tr>
        </thead>
        <tbody id="attachments"></tbody>
    </table>
</div>
<div class="form-group mr-3  col-sm-3">
    <input class="btn btn-outline-primary mr-4" type="button" value="Update" id="finalEdit">
    <a href="./" class="btn btn-outline-danger mr-4">Cancel</a>
    <p id="serverErrors" style="color: crimson"></p>
    <p id="contactErrors" style="color: crimson"></p>
</div>

</body>

<script>
  "use strict";
  document.getElementById("deleteButton").addEventListener("click", deletePhones);
  document.getElementById("openAddPopUp").addEventListener("click", function openPopUp() {
    document.getElementById("addPhonePopUp").style.display = "block";
    document.getElementById("editPhonePopUp").style.display = "none";
    document.getElementById("addAttachmentPopUp").style.display = "none";
    document.getElementById("editAttachmentPopUp").style.display = "none";
  });
  document.getElementById("openEditPopUp").addEventListener("click", editPhoneFillInputs);
  document.getElementById("closeAddPopUp").addEventListener("click", function closePopUp() {
    document.getElementById("addPhonePopUp").style.display = "none";
  });
  document.getElementById("closeEditPopUp").addEventListener("click", function closePopUp() {
    document.getElementById("editPhonePopUp").style.display = "none";
  });
  document.getElementById("createPhone").addEventListener("click", createPhone);
  document.getElementById("editPhone").addEventListener("click", editPhone);

  document.getElementById("deleteAttachmentButton").addEventListener("click", deleteAttachments);
  document.getElementById("openAddAttachmentPopUp").addEventListener("click", function openPopUp() {
    document.getElementById("addAttachmentPopUp").style.display = "block";
    document.getElementById("editAttachmentPopUp").style.display = "none";
    document.getElementById("addPhonePopUp").style.display = "none";
    document.getElementById("editPhonePopUp").style.display = "none";
  });
  document.getElementById("openEditAttachmentPopUp").addEventListener("click", editAttachmentFillInputs);
  document.getElementById("closeAddAttachmentPopUp").addEventListener("click", function closePopUp() {
    document.getElementById("addAttachmentPopUp").style.display = "none";
  });
  document.getElementById("closeEditAttachmentPopUp").addEventListener("click", function closePopUp() {
    document.getElementById("editAttachmentPopUp").style.display = "none";
  });
  document.getElementById("createAttachment").addEventListener("click", createAttachment);
  document.getElementById("editAttachment").addEventListener("click", editAttachment);
  document.getElementById("downloadAttachmentsButton").addEventListener("click", downloadAttachment);

  document.getElementById("finalEdit").addEventListener("click", function () {
    if (validateContact('editForm')) {
      tablePhonesJson();
      tableAttachmentsJson();
      savePhoto();
      var editForm = document.getElementById("editForm");
      var formData = new FormData(editForm);
      fetch("controller/edit_contact", {
        method: "POST",
        body: formData
      }).then(function (resp) {
        var status = resp.status;
        if (status === 200) {
          window.location = "./";
        } else {
          handleValidationErrors(resp);
          handleErrorsLoading(resp);
        }
      });
    }
  });

</script>
<script src="js/dateDropDownList.js"></script>
</html>